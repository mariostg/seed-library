{% load i18n %}
{% load static %}

<div style="display: flex; flex-direction: column; align-items: center; ">


  {% if item_count == 0 and request.GET %}
    <div class="alert alert--info">
      {% trans "No plant matches your search, try resetting the filters or verify your search term." %}
    </div>
  {% endif %}
  <div id='search-results'>
    {% if object_list %}
      <div>
        <div class='flex-col-center'>{% trans "Search Results: Found" %} {{item_count}} {% trans "matches" %}</div>
        <div class='flex-col-center'>
          <a href="{% url 'export-plant-search-results' %}?{{ request.GET.urlencode }}" class="btn btn-primary">{% trans "Export to CSV" %}</a>
        </div>
      </div>

    {% endif %}
    <section id="plant-cards" class="plant-cards">
      {% for item in object_list  %}
        <div class="plant-card {% if not item.is_active %}plant-card-not-active{% endif %}">

          {% if request.user.is_authenticated %}
            <span
              id="favourite-{{ item.pk }}"
              class="plant-card-is-{% if item.pk in favourite_plants %}favourite{% else %}not-favourite{% endif %}"
              hx-get="{% url 'user-plant-toggle' item.id %}"
              hx-swap="outerHTML"
              hx-target="#favourite-{{ item.pk }}"
              hx-swap="innerHTML"
              hx-trigger="click"
            ></span>
          {% endif %}

          <div>
            <a target="_blank" href="{% url 'plant-profile-page' item.id %}" class="plant-card-link">
              {% if item.images.first %}
                <img src="{{item.images.first.image.url}}" alt="image for {{item.latin_name}}">
              {% else %}
                <img src="{% static 'images/plant-placeholder.png' %}" alt="No image available">
              {% endif %}
            </a>
            {% if item.images.first %}
              <div class="plant-card-source">{% trans "Source" %}: {{item.images.first.photo_author}}</div>
            {% endif %}
          </div>
          <div class="plant-card-caption">
            <div class="plant-type-icon">
              <img src="{% static 'images/' %}plant-type-{{item.growth_habit.growth_habit_en}}.svg" alt="image of {{item.growth_habit}}" />
            </div>
            <div class="plant-names">
              <span>{{item.english_name}}</span>
              <span>{{item.latin_name}}</span>
              <span>{{item.french_name}}</span>
            </div>
          </div>
          {% if user.is_authenticated %}
            <div class="flex-row wide">
              <a class='btn' target="#">Add to cart</a>
              <a class='btn' target="blank" href="{% url 'plant-label-pdf' item.pk%}">{% trans "Labels" %}</a>
            </div>
          {% endif %}
        </div>
        {% if object_list.has_next and forloop.last %}
          <span
            hx-get="{% url 'search-plant-name' %}?page={{ page_obj.next_page_number }}"
            hx-swap="beforeend"
            hx-target="#search-results"
            hx-select=".plant-card"
            hx-push-url="true"
            hx-trigger="revealed"
          >
          </span>
        {% endif %}
      {% endfor %}
    </section>

  </div>

</div>
